<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="An online preview tool for Testmail." />
  <meta name="author" content="TBXark" />
  <title>TestMail</title>
  <script src="https://unpkg.com/vue@3.3.4/dist/vue.global.prod.js"></script>
  <link href="https://unpkg.com/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <main id="app">
    <div class="sidebar" :class="{ hidden: showContent }">
      <div class="sidebar-header">
        <span class="fs-5 fw-semibold" style="font-weight: 600">TestMail <span style="font-size: 10px">by <a
              style="color: black" href="https://github.com/TBXark/testmail-viewer">TBXark</a></span></span>
      </div>
      <div class="sidebar-form">
        <input v-model="namespace" class="form-control" placeholder="namespace: xxxx" />
        <input v-model="apikey" class="form-control" placeholder="apikey: xxxxx-xxxxx-xxxx-xxxx-xxxxxxxxxx"
          type="password" />
        <button @click="loadData(0)" class="w-100 btn btn-lg btn-dark btn-load" type="submit">
          Load
        </button>
      </div>
      <div class="email-list">
        <div v-for="item in items" :key="item.id" class="email-item" :class="{ active: item === current }"
          @click="selectItem(item)">
          <div class="email-item-subject">{{ item.subject }}</div>
          <div class="email-item-meta">
            <strong>From</strong> {{ item.from }}
          </div>
          <div class="email-item-meta">
            <strong>To</strong> {{ item.to }}
          </div>
        </div>
        <button v-if="offset && items.length > 0" class="load-more-btn" @click="loadData(offset)">
          Load More
        </button>
      </div>
    </div>
    <div class="divider"></div>
    <div class="content-area" :class="{ visible: showContent }">
      <button class="mobile-back-btn" @click="goBack">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5"
          stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5L8.25 12l7.5-7.5" />
        </svg>
      </button>
      <template v-if="current">
        <div class="content-header">
          <h3>{{ current?.subject }}</h3>
          <h6><strong>From:</strong> {{ current?.from }}</h6>
          <h6><strong>To:</strong> {{ current?.to }}</h6>
          <h6><strong>Date:</strong> {{ new Date(current?.date).toLocaleString() }}</h6>
          <div v-if="current?.attachments?.length > 0">
            <h6 style="margin-top: 12px;"><strong>Attachments:</strong></h6>
            <ul class="attachment-list">
              <li v-for="attachment in current?.attachments" :key="attachment.cid" class="attachment-item">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                  <path
                    d="M14 4.5V14a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2h5.5L14 4.5zm-3 0A1.5 1.5 0 0 1 9.5 3V1H4a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V4.5h-2z" />
                </svg>
                <a :href="attachment.downloadUrl" target="_blank" rel="noopener noreferrer">
                  {{ attachment.filename }}
                </a>
                <span style="color: #666;">({{ fileSizeToString(attachment.size) }})</span>
              </li>
            </ul>
          </div>
        </div>
        <div class="content-body">
          <div class="alert alert-warning alert-dismissible fade show" role="alert"
            v-if="showAlert && !showHTML && current?.html" style="margin-bottom: 16px;">
            Click
            <strong @click="showHTML = true" style="cursor: pointer; text-decoration: underline;">
              here
            </strong>
            to show HTML content
            <button type="button" class="btn-close" aria-label="Close" @click="showAlert = false"></button>
          </div>
          <iframe :src="encodedHTML" v-if="showHTML"></iframe>
          <p v-else>{{ current?.text }}</p>
        </div>
      </template>
      <div v-else class="empty-state">
        Select an email to view
      </div>
    </div>
  </main>
  <script src="script.js"></script>
</body>

</html>